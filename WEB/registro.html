<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Signup - InfoRace</title>
  <link rel="stylesheet" href="style.css">
</head>
<body id="registro">
  <header id="top">
    <ul class="menu_horizontal">
      <li class="option" id="logo"><img id="imglogo" src="logo.png" alt="Logo de InfoRace"></li>
      <li class="option"><a class="link" href="index.html">Inicio</a></li>
      <li class="option"><a class="link" href="about.html">Sobre Nosotros</a></li>
      <li class="option"><a class="link" href="download.html">Descargar</a></li>
    </ul>
  </header>

  <div id="mid">
    <h1 class="registration-title">Regístrate en InfoRace</h1>
    <form id="signup-form" class="registration-form" action="javascript:void(0);">
      <div class="form-group">
        <label for="email">Correo Electrónico:</label>
        <input type="email" id="email" name="email" required class="form-input">
      </div>
      <div class="form-group">
        <label for="password">Contraseña:</label>
        <input type="password" id="password" name="password" required class="form-input">
      </div>
      <div class="form-group">
        <label for="confirm-password">Confirmar Contraseña:</label>
        <input type="password" id="confirm-password" name="confirm-password" required class="form-input">
      </div>
      <div class="form-group">
        <label for="username">Nombre de Usuario:</label>
        <input type="text" id="username" name="username" required class="form-input">
      </div>
      <div class="form-group">
        <label for="phone">Teléfono:</label>
        <input type="tel" id="phone" name="phone" required pattern="[0-9]{9}" class="form-input">
      </div>
      <div class="form-group">
        <input type="checkbox" id="terms" name="terms" required>
        <label for="terms">Acepto los <a href="terminos_condiciones.pdf" target="_blank">Términos y Condiciones</a></label>
      </div>
      <div class="form-group">
        <input type="checkbox" id="receive-emails" name="receive-emails">
        <label for="receive-emails">Acepto recibir información por correo electrónico</label>
      </div>
      <button type="button" onclick="enviarDatos()">Registrarse</button>
      <div class="form-group">
        <label for="password" class="form-label" style="color: #FFFF;">¿Ya tienes una Cuenta?</label>
      </div>
      <div class="form-group">
        <a style="color:#FFFF;" class="link" href="login.html">Iniciar Sesión</a></label>
      </div>
    </form>
  </div>

  <footer id="bottom">
    <ul>
      <li class="option">
        <a class="link" href="instagram.com">Instagram</a>
      </li>
      <li class="option">
        <a class="link" href="twitter.com">Twitter</a>
      </li>
      <li class="option option-left">
        <a class="link" href="facebook.com">Facebook</a>
      </li>
      <p>Copyright © 2024 Inforace. Todos los derechos reservados.</p>
      <li class="option option-right">
        <a class="link" href="index.html">Ayuda</a>
      </li>
      <li class="option">
        <a class="link" href="about.html">Sobre Nosotros</a>
      </li>
    </ul>
  </footer>

  <!-- Scripts de Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>

  <script>
    // Inicializa Firebase con la configuración de tu proyecto
    const firebaseConfig = {
      apiKey: "AIzaSyAnvZ7K3Dy5ul_FpQhjkObEowqurKxoFLQ",
      authDomain: "inforace-fde66.firebaseapp.com",
      projectId: "inforace-fde66",
      storageBucket: "inforace-fde66.appspot.com",
      messagingSenderId: "258719866165",
      appId: "1:258719866165:web:9e785e8a66559b78f1407c"
    };
    firebase.initializeApp(firebaseConfig);

    // Clave de encriptación
    const key = CryptoJS.enc.Utf8.parse('1234567890123456');
    const iv = CryptoJS.enc.Utf8.parse('1234567890123456');

    // Función para encriptar la contraseña
    function encryptPassword(password) {
      const encrypted = CryptoJS.AES.encrypt(password, key, { iv: iv, padding: CryptoJS.pad.Pkcs7, mode: CryptoJS.mode.CBC });
      return encrypted.toString();
    }

    // Función para enviar datos a Firestore
    function enviarDatos() {
      // Obtén los valores de los campos de entrada
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const confirmPassword = document.getElementById('confirm-password').value;
      const username = document.getElementById('username').value;
      const phone = document.getElementById('phone').value;
      const receiveEmails = document.getElementById('receive-emails').checked;

      if (password !== confirmPassword) {
        alert("Las contraseñas no coinciden");
        return;
      }

      // Encripta la contraseña
      const encryptedPassword = encryptPassword(password);

      // Agrega los datos a Firestore usando el correo como ID
      const db = firebase.firestore();
      db.collection("UserData").doc(email).set({
        email: email,
        password: encryptedPassword,
        username: username,
        phone: phone,
        recibirNotificaciones: receiveEmails
      })
      .then(() => {
        console.log("Documento agregado con ID: ", email);
        // Redirige a otra página después de agregar los datos
        window.location.href = "login.html";
      })
      .catch((error) => {
        console.error("Error al agregar el documento: ", error);
      });
    }
  </script>
</body>
</html>
